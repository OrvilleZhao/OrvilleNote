本溪支付宝项目说明==================## 一、项目模块组成#### 本项目一共由十三个模块组成，下面是模块构成介绍* 网络模块 > 该模块主要负责和支付宝进行sslsocket通讯,使用java编写主要的功能。采用命名模式与其他模块进行连接。一共由8个文件组成.  >* ByteDataBuffer.java: 该类主要是支付宝提供的装包和拆包的工具类  >* Log.java: 该类是测试时使用的,已废弃  >* Result.java: 该类是其他模块向网络模块传递的消息类，包含了消息主题和服务码  >* SolveRequest.java: 该类是网络模块向其他模块传递的消息类  >* SolveRequestListener.java: 其他模块实现该接口，使网络模块通过命令模式调用其他模块逻辑  >* SSLClient.java: 该类是客户端类，受后续开发文档变动影响，该类已废弃  >* SSLConnect.java: 该类主要复杂拆包和装包  >* SSLServer.java: 该类是服务端类，主要负责接受支付宝的请求并回应（未采用线程池技术）* 界面模块(Wbas) > 该模块的主要功能是进行界面呈现 >* Form1.cs: 主界面代码文件，分为控件事件触发、数据处理、自定义事件和Panel操作    1. 控件事件触发 </br>      该部分主要是响应界面切换的按钮事件。    2. 数据处理 </br>      该部分主要包括的是日结情况和代缴流水两部分的数据处理和显示，并对分页进行支持    3. 自定义事件 </br>      该部分主要包括，分页控件响应，配置修改及其他控件事件响应支持    4. Panel操作 </br>      该部分主要功能就是绘制界面 >* UserComboBox.cs: 下拉列表控件 >* UserDateTimerPicker.cs: 时间选择控件 >* UserFileDialog.cs: 文件控件 >* UserTextBox.cs: 文本框控件 >* PageControl.cs: 分页控件  * 数据层模块(WBasModel)</br>> 该模块主要包含各协议所需使用的数据类和老系统使用的数据类，具体细节不予详述*  基础工具模块(Basic)</br>> 该模块主要提供一些必要的工具</br>>* Communicate.cs 是ClientModule和ServerModule的父类>* GlobalVar.cs 提供系统缓存变量>* JsonHelper.cs 提供Json解析>* SFTHelper.cs 提供SFTP操作工具>* StringHelper.cs 做特定字符串转换   * 业务模块(Business)> 该模块完成所有业务逻辑>* WbasALiPay.cs 包含200001,200002.200011,200012，100001五种协议逻辑	1. 200001 </br>          	欠款查询协议	2. 200002 </br>          	 缴费接口	3. 200011 </br>          代收对账	4. 200012 </br>          销账	5. 100001 </br>          出账通知>*  Wbasf.cs和Wbaspub.cs 包含PB旧系统相关业务逻辑* `客户端模块(ClientModule) 该模块已废弃`* `代码表模块(CodeTable)  该模块未使用`* 数据库管理模块(DataAccess) > 该模块由于历史原因使用了两个类* 日志模块(Log)> 该模块主要用于记录错误日志* 定时器模块(QuartzSict)> 该模块调用了Quartz,实现了每天定时向支付宝sftp发送出账通知* 服务器模块(ServerModule)> 该模块主要完成对网络层数据的处理和返回>* ServerModule.cs 负责启动网络层监听>* Solve.cs 实现了网络层SolveRequestListener接口,对网络接收到的报文进行解析处理并返回应答报文* 消息模块(SingleMessage)    > 该模块主要完成各组件和界面层的消息传递，消息传递是通过命令模式广播    1. Message.cs 消息类    2. MessageReceiveBuffer.cs 记录接受到的消息    3. MessageSendBuffer.cs 记录发送的消息    4. MsgInterface.cs 消息广播接口，用于各类消息发布事件类实现。    ## 二、对数据库的一些变动> 新增wb_account表> 将wb_hmvht.TLCS修改为15位> 将wb_cmvht.TLCS修改为15位> 将wb_printbill.TLCS修改为15位> wb_ptsta新增一条数据,sql语句为 insert into wb_ptsta(CHTN,TLNO,LGNM,TLNM,TLPS,TRSQ,TLLV,TLTP,SOTM,SFTM,SSSG,CHBL,OBBL,TLBL,STCD)values(C99,C99001,C99001,'支付宝代收1',888888,0,1,1,20050101,20050101,0,0,0,0,0)     